// Xy.js - https://github.com/thunder9/xy.js
(function(){"use strict";function t(i,e){function r(t){for(var i in t)this[i]=t[i]}if(this.ctx=i,r.prototype=t.defaults,this.options=new r(e),this.width=this.options.width||i.canvas.width,this.height=this.options.height||i.canvas.height,window.devicePixelRatio){var a=window.getComputedStyle(i.canvas);"auto"===a.width&&(i.canvas.style.width=this.width+"px"),"auto"===a.height&&(i.canvas.style.height=this.height+"px"),i.canvas.width=this.width*window.devicePixelRatio,i.canvas.height=this.height*window.devicePixelRatio,i.scale(window.devicePixelRatio,window.devicePixelRatio)}}function i(t){var i=this.ctx,n=this.options;i.font=n.labelFontStyle+" "+n.labelFontSize+"px '"+n.labelFontName+"'",this.ticksX=r(this,t),this.ticksY=a(this,t);var o=this.rangeX=[],h=this.rangeY=[];o[0]="auto"===n.rangeX[0]?this.ticksX[0]:+n.rangeX[0],o[1]="auto"===n.rangeX[1]?this.ticksX[Math.max(this.ticksX.length-1,0)]:+n.rangeX[1],h[0]="auto"===n.rangeY[0]?this.ticksY[0]:+n.rangeY[0],h[1]="auto"===n.rangeY[1]?this.ticksY[Math.max(this.ticksY.length-1,0)]:+n.rangeY[1];var s=n.pointCircleRadius+n.pointStrokeWidth/2,l=this.padding=Math.max(n.labelFontSize/2,s),c=this.width,u=this.height,p=this.labelSizeY=this.measureLabelSizeY(this.ticksY,n.labelFontSize),f=p.width+l,d=this.labelSizeX=this.measureLabelSizeX(this.ticksX,n.labelFontSize,c-f),g=d.height+l;f=Math.max(f,d.rot===Math.PI/4?d.width:d.width/2);var v=this.lengthX=o[1]-o[0],x=this.lengthY=h[1]-h[0],w=Math.max(l,d.rot===Math.PI/4?0:d.width/2),y=v>0?(c-f-w)/v:1,m=x>0?(u-g-l)/x:1;this.pointRadiusX=s/y,this.pointRadiusY=s/m,function(){function t(t,i){return(t*i-o[0])*y+f}function r(t,i){return(h[0]-t*i)*m+u-g}function a(t,i){return t*i*y}function s(t,i){return-t*i*m}i.xy=new Transform(i,{x:e(t)(1),y:e(r)(1)}),i.xywhr=new Transform(i,{x:e(t)(1),y:e(r)(1),width:e(a)(1),height:e(s)(1),radius:"y"===n.scalingRadius?e(s)(-1):e(a)(1)}),i.nxy=new Transform(i,{x:e(t)(v),y:e(r)(x)}),i.nxywhr=new Transform(i,{x:e(t)(v),y:e(r)(x),width:e(a)(v),height:e(s)(x),radius:"y"===n.scalingRadius?e(s)(-x):e(a)(v)})}()}function e(t){return function(i){return function(e){return t(e,i)}}}function r(t,i){var e=h({lower:t.options.rangeX[0],upper:t.options.rangeX[1],incr:t.options.tickStepX},i,0,function(i){var e=t.measureLabelSizeX(i,t.options.labelFontSize);return{offset:e.height,hop:e.width}},t.width);return n(e.lower,e.upper,e.incr,t.width)}function a(t,i){var e=h({lower:t.options.rangeY[0],upper:t.options.rangeY[1],incr:t.options.tickStepY},i,1,function(i){var e=t.measureLabelSizeY(i,t.options.labelFontSize);return{offset:e.width,hop:e.height}},t.height);return n(e.lower,e.upper,e.incr,t.height)}function n(t,i,e,r){var a,n=u.exec(e)[0],h=/e/.test(n)?-n.substring(1):/\./.test(n)?n.length-1:-n.length,s=[],l=0;for(t=e*Math.ceil(t/e);i>=(a=o(t+l*e,h))&&(r||1/0)>l;)s[l++]=a;return s}function o(t,i){var e=Math.abs(t)*Math.pow(10,i),r=1e21>e?e.toFixed().length:21;return+t.toPrecision(r)}function h(t,i,e,r,a){var o,h;if("auto"===t.lower||"auto"===t.upper){o=Number.MAX_VALUE,h=Number.MIN_VALUE;for(var l=0;i.length>l;l++)for(var c=i[l].data,u=0;c.length>u;u++)c[u][e]>h&&(h=c[u][e]),o>c[u][e]&&(o=c[u][e])}if("auto"!==t.lower&&(o=t.lower),"auto"!==t.upper&&(h=t.upper),"auto"===t.incr){t.incr=s(h-o,1);for(var p=2;a>p;p++){var f=s(h-o,p),d=r(n(o,h,f));if(p>a/(1.5*d.hop))break;t.incr=f}}return"auto"===t.lower&&(t.lower=t.incr*Math.floor(o/t.incr)),"auto"===t.upper&&(t.upper=t.incr*Math.ceil(h/t.incr)),t}function s(t,i){for(var e=Math.floor(Math.log(t)*Math.LOG10E),r=0;t>0&&i>0;e--)for(var a=0;p.length>a;a++){var n=Math.pow(10,e)*p[a];if(t/n>i)return+r.toPrecision(1);r=n}return r}function l(t,i){var e,r=t.x-t.prev.prev.x,a=t.y-t.prev.prev.y,n=r*r+a*a,o=c(t,t.prev),h=c(t.prev,t.prev.prev);e=h>0?Math.sqrt(h/n)*i:Math.sqrt(o/n)*i,t.prev.cp2x=t.prev.x-r*e,t.prev.cp2y=t.prev.y-a*e,e=Math.sqrt(o/n)*i,t.cp1x=t.prev.x+r*e,t.cp1y=t.prev.y+a*e}function c(t,i){var e=t.x-i.x,r=t.y-i.y;return e*e+r*r}t.prototype.draw=function(t,e){var r=this.ctx,a=this.options;this.ticksX&&this.ticksY&&!e||i.call(this,t),r.clearRect(0,0,this.width,this.height),this.before(),a.grid&&(r.strokeStyle=a.gridColor,r.lineWidth=a.gridWidth,this.drawXGrids(this.ticksX,this.rangeY),this.drawYGrids(this.ticksY,this.rangeX)),a.scale&&(r.strokeStyle=a.scaleColor,r.lineWidth=a.scaleWidth,this.drawXScale(this.rangeX,this.ticksX,this.rangeY[0]),this.drawYScale(this.rangeY,this.ticksY,this.rangeX[0])),a.label&&(r.fillStyle=a.labelColor,r.save(),r.translate(0,this.padding),this.drawXLabels(this.ticksX,this.rangeY[0],this.labelSizeX.rot),r.restore(),r.save(),r.translate(-this.padding,0),this.drawYLabels(this.ticksY,this.rangeX[0]),r.restore()),r.save(),r.beginPath(),r.xywhr.rect(this.rangeX[0]-this.pointRadiusX,this.rangeY[0]-this.pointRadiusY,this.lengthX+2*this.pointRadiusX,this.lengthY+2*this.pointRadiusY),r.clip(),a.line&&(r.lineWidth=a.lineWidth,this.drawLines(t)),a.point&&(r.lineWidth=a.pointStrokeWidth,this.drawPoints(t)),this.plot(t),r.restore(),this.after()},t.prototype.measureLabelSizeX=function(t,i,e){for(var r=this.ctx,a=0,n=0;t.length>n;n++){var o=r.measureText(this.formatXLabel(t[n]));o.width>a&&(a=o.width)}var h={width:a,height:i,rot:0};if(!e)return h;var s=e/t.length;if(h.width>s){h.rot=Math.PI/4;var l=Math.cos(h.rot);h.width=a*l,h.height=h.width+i*l,h.width>s&&(h.rot=Math.PI/2,h.width=i,h.height=a)}return h},t.prototype.measureLabelSizeY=function(t,i){for(var e=this.ctx,r=1,a=0;t.length>a;a++){var n=e.measureText(this.formatYLabel(t[a]));n.width>r&&(r=n.width)}return{width:r,height:i}},t.prototype.drawXGrids=function(t,i){for(var e=this.ctx,r=0;t.length>r;r++)e.beginPath(),e.xy.moveTo(t[r],i[0]),e.xy.lineTo(t[r],i[1]),e.stroke()},t.prototype.drawYGrids=function(t,i){for(var e=this.ctx,r=0;t.length>r;r++)e.beginPath(),e.xy.moveTo(i[0],t[r]),e.xy.lineTo(i[1],t[r]),e.stroke()},t.prototype.drawXScale=function(t,i,e){var r=this.ctx;r.beginPath(),r.xy.moveTo(t[0],e),r.xy.lineTo(t[1],e),r.stroke()},t.prototype.drawYScale=function(t,i,e){var r=this.ctx;r.beginPath(),r.xy.moveTo(e,t[0]),r.xy.lineTo(e,t[1]),r.stroke()},t.prototype.drawXLabels=function(t,i,e){var r=this.ctx;if(0===e){r.textBaseline="top",r.textAlign="center";for(var a=0;t.length>a;a++)r.xy.fillText(this.formatXLabel(t[a]),t[a],i)}else{r.textBaseline="middle",r.textAlign="right",e===Math.PI/4&&r.translate(0,.3*this.options.labelFontSize);for(var a=0;t.length>a;a++)r.save(),r.xy.translate(t[a],i),r.rotate(-e),r.fillText(this.formatXLabel(t[a]),0,0),r.restore()}},t.prototype.drawYLabels=function(t,i){var e=this.ctx;e.textBaseline="middle",e.textAlign="right";for(var r=0;t.length>r;r++)e.xy.fillText(this.formatYLabel(t[r]),i,t[r])},t.prototype.formatXLabel=function(t){return t},t.prototype.formatYLabel=function(t){return t},t.prototype.drawLines=function(t){for(var i=this.ctx,e=this.options.smooth,r=this.rangeX[1]-this.rangeX[0],a=this.rangeY[1]-this.rangeY[0],n=0;t.length>n;n++){i.strokeStyle=t[n].lineColor;var o=t[n].data;if(i.beginPath(),o.length>0&&i.xy.moveTo(o[0][0],o[0][1]),e&&o.length>2){for(var h=null,s=[],c=0;o.length>c;c++){var u={x:o[c][0]/r,y:o[c][1]/a,prev:h};h=u,s[c]=h,h.prev&&h.prev.prev&&l(h,e)}for(var c=1;s.length>c;c++){var h=s[c];h.cp1x&&h.cp2x?i.nxy.bezierCurveTo(h.cp1x,h.cp1y,h.cp2x,h.cp2y,h.x,h.y):h.cp1x?i.nxy.quadraticCurveTo(h.cp1x,h.cp1y,h.x,h.y):i.nxy.quadraticCurveTo(h.cp2x,h.cp2y,h.x,h.y)}}else for(var c=1;o.length>c;c++)i.xy.lineTo(o[c][0],o[c][1]);i.stroke()}},t.prototype.drawPoints=function(t){for(var i=this.ctx,e=this.options.pointCircleRadius,r=0;t.length>r;r++){i.fillStyle=t[r].pointColor,i.strokeStyle=t[r].pointStrokeColor;for(var a=t[r].data,n=0;a.length>n;n++)i.beginPath(),i.xy.arc(a[n][0],a[n][1],e,0,2*Math.PI),i.fill(),i.stroke()}},t.prototype.plot=function(){},t.prototype.before=function(){},t.prototype.after=function(){};var u=/0*$|\.\d*|e[+-]\d+/,p=[10,5,2];t.defaults={rangeX:["auto","auto"],rangeY:["auto","auto"],tickStepX:"auto",tickStepY:"auto",scale:!0,scaleColor:"rgba(0,0,0,.1)",scaleWidth:1,grid:!0,gridColor:"rgba(0,0,0,.05)",gridWidth:1,label:!0,labelFontName:"Arial",labelFontSize:20,labelFontStyle:"normal",labelColor:"#666",point:!0,pointCircleRadius:8,pointStrokeWidth:4,line:!0,lineWidth:4,smooth:.3,scalingRadius:"x"},this.Xy=t}).call(this),function(){"use strict";function t(t,e,r){if(this.native=t,r){var a=Array.prototype.slice;for(var n in t){var o=t[n];"function"==typeof o&&function(i,e){i[n]=function(){var i=a.call(arguments);return e.apply(t,i)}}(this,o)}}var h=e.x||i,s=e.y||i,l=e.width||i,c=e.height||i,u=e.radius||i;this.arc=function(i,e,r,a,n,o){t.arc(h(i),s(e),u(r),a,n,o)},this.arcTo=function(i,e,r,a,n){t.arcTo(h(i),s(e),h(r),s(a),u(n))},this.bezierCurveTo=function(i,e,r,a,n,o){t.bezierCurveTo(h(i),s(e),h(r),s(a),h(n),s(o))},this.clearRect=function(i,e,r,a){t.clearRect(h(i),s(e),l(r),c(a))},this.createImageData=function(i,e){return t.createImageData(l(i),c(e))},this.createLinearGradient=function(i,e,r,a){return t.createLinearGradient(h(i),s(e),h(r),s(a))},this.createRadialGradient=function(i,e,r,a,n,o){return t.createRadialGradient(h(i),s(e),u(r),h(a),s(n),u(o))},this.drawImage=function(i,e,r,a,n,o,u,p,f){3===arguments.length?t.drawImage(i,h(e),s(r)):5===arguments.length?t.drawImage(i,h(e),s(r),l(a),c(n)):t.drawImage(i,e,r,a,n,h(o),s(u),l(p),c(f))},this.fillRect=function(i,e,r,a){t.fillRect(h(i),s(e),l(r),c(a))},this.fillText=function(i,e,r,a){4===arguments.length?t.fillText(i,h(e),s(r),a):t.fillText(i,h(e),s(r))},this.getImageData=function(i,e,r,a){return t.getImageData(h(i),s(e),l(r),c(a))},this.isPointInPath=function(i,e){return t.isPointInPath(h(i),s(e))},this.lineTo=function(i,e){t.lineTo(h(i),s(e))},this.moveTo=function(i,e){t.moveTo(h(i),s(e))},this.putImageData=function(i,e,r,a,n,o,l){t.putImageData(i,h(e),s(r),a,n,o,l)},this.quadraticCurveTo=function(i,e,r,a){t.quadraticCurveTo(h(i),s(e),h(r),s(a))},this.rect=function(i,e,r,a){t.rect(h(i),s(e),l(r),c(a))},this.strokeRect=function(i,e,r,a){t.strokeRect(h(i),s(e),l(r),c(a))},this.strokeText=function(i,e,r,a){4===arguments.length?t.strokeText(i,h(e),s(r),a):t.strokeText(i,h(e),s(r))},this.translate=function(i,e){t.translate(h(i),s(e))}}var i=function(t){return t};this.Transform=t}.call(this);