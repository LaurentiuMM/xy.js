// Xy.js - https://github.com/thunder9/xy.js
(function(){"use strict";function t(e,i){function r(t){for(var e in t)this[e]=t[e]}this.ctx=e,r.prototype=t.defaults,this.options=new r(i),this.width=e.canvas.width,this.height=e.canvas.height,window.devicePixelRatio&&(e.canvas.style.width=this.width+"px",e.canvas.style.height=this.height+"px",e.canvas.width=this.width*window.devicePixelRatio,e.canvas.height=this.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio))}function e(t){return function(e){return function(i){return t(i,e)}}}function i(t,e){var i=o({lower:t.options.rangeX[0],upper:t.options.rangeX[1],incr:t.options.tickStepX},e,0,function(e){var i=t.measureLabelSizeX(e,t.options.labelFontSize);return{offset:i.height,hop:i.width}},t.width);return n(i.lower,i.upper,i.incr,t.width)}function r(t,e){var i=o({lower:t.options.rangeY[0],upper:t.options.rangeY[1],incr:t.options.tickStepY},e,1,function(e){var i=t.measureLabelSizeY(e,t.options.labelFontSize);return{offset:i.width,hop:i.height}},t.height);return n(i.lower,i.upper,i.incr,t.height)}function n(t,e,i,r){var n,o=c.exec(i)[0],h=/e/.test(o)?-o.substring(1):/\./.test(o)?o.length-1:-o.length,s=[],l=0;for(t=i*Math.ceil(t/i);e>=(n=a(t+l*i,h))&&(r||1/0)>l;)s[l++]=n;return s}function a(t,e){var i=Math.abs(t)*Math.pow(10,e),r=1e21>i?i.toFixed().length:21;return+t.toPrecision(r)}function o(t,e,i,r,a){var o,s;if("auto"===t.lower||"auto"===t.upper){o=Number.MAX_VALUE,s=Number.MIN_VALUE;for(var l=0;e.length>l;l++)for(var c=e[l].data,u=0;c.length>u;u++)c[u][i]>s&&(s=c[u][i]),o>c[u][i]&&(o=c[u][i])}if("auto"!==t.lower&&(o=t.lower),"auto"!==t.upper&&(s=t.upper),"auto"===t.incr){t.incr=h(s-o,1);for(var p=2;a>p;p++){var d=h(s-o,p),f=r(n(o,s,d));if(p>a/(1.5*f.hop))break;t.incr=d}}return"auto"===t.lower&&(t.lower=t.incr*Math.floor(o/t.incr)),"auto"===t.upper&&(t.upper=t.incr*Math.ceil(s/t.incr)),t}function h(t,e){for(var i=Math.floor(Math.log(t)*Math.LOG10E),r=0;t>0&&e>0;i--)for(var n=0;u.length>n;n++){var a=Math.pow(10,i)*u[n];if(t/a>e)return+r.toPrecision(1);r=a}return r}function s(t,e){var i,r=t.x-t.prev.prev.x,n=t.y-t.prev.prev.y,a=r*r+n*n,o=l(t,t.prev),h=l(t.prev,t.prev.prev);i=h>0?Math.sqrt(h/a)*e:Math.sqrt(o/a)*e,t.prev.cp2x=t.prev.x-r*i,t.prev.cp2y=t.prev.y-n*i,i=Math.sqrt(o/a)*e,t.cp1x=t.prev.x+r*i,t.cp1y=t.prev.y+n*i}function l(t,e){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}t.prototype.draw=function(t,n){var a=this.ctx,o=this.options;if(!this.ticksX||!this.ticksY||n){a.font=o.labelFontStyle+" "+o.labelFontSize+"px '"+o.labelFontName+"'",this.ticksX=i(this,t),this.ticksY=r(this,t);var h=this.rangeX=[],s=this.rangeY=[];h[0]="auto"===o.rangeX[0]?this.ticksX[0]:+o.rangeX[0],h[1]="auto"===o.rangeX[1]?this.ticksX[this.ticksX.length-1]:+o.rangeX[1],s[0]="auto"===o.rangeY[0]?this.ticksY[0]:+o.rangeY[0],s[1]="auto"===o.rangeY[1]?this.ticksY[this.ticksY.length-1]:+o.rangeY[1];var l=this.padding=Math.max(o.labelFontSize/2,o.pointCircleRadius+o.pointStrokeWidth/2),c=this.width,u=this.height,p=this.labelSizeY=this.measureLabelSizeY(this.ticksY,o.labelFontSize),d=p.width+l,f=this.labelSizeX=this.measureLabelSizeX(this.ticksX,o.labelFontSize,c-d),g=f.height+l;d=Math.max(d,f.rot===Math.PI/4?f.width:f.width/2);var v=h[1]-h[0],x=s[1]-s[0],w=Math.max(l,f.rot===Math.PI/4?0:f.width/2),y=(c-d-w)/v,b=(u-g-l)/x;(function(){function t(t,e){return(t*e-h[0])*y+d}function i(t,e){return(s[0]-t*e)*b+u-g}function r(t,e){return t*e*y}function n(t,e){return-t*e*b}a.xy=new Transform(a,{x:e(t)(1),y:e(i)(1)}),a.xywhr=new Transform(a,{x:e(t)(1),y:e(i)(1),width:e(r)(1),height:e(n)(1),radius:"y"===o.scalingRadius?e(n)(-1):e(r)(1)}),a.nxy=new Transform(a,{x:e(t)(v),y:e(i)(x)}),a.nxywhr=new Transform(a,{x:e(t)(v),y:e(i)(x),width:e(r)(v),height:e(n)(x),radius:"y"===o.scalingRadius?e(n)(-x):e(r)(v)})})()}a.clearRect(0,0,this.width,this.height),this.before(),o.grid&&(a.strokeStyle=o.gridColor,a.lineWidth=o.gridWidth,this.drawXGrids(this.ticksX,this.rangeY),this.drawYGrids(this.ticksY,this.rangeX)),o.scale&&(a.strokeStyle=o.scaleColor,a.lineWidth=o.scaleWidth,this.drawXScale(this.rangeX,this.ticksX,this.rangeY[0]),this.drawYScale(this.rangeY,this.ticksY,this.rangeX[0])),o.label&&(a.fillStyle=o.labelColor,a.save(),a.translate(0,this.padding),this.drawXLabels(this.ticksX,this.rangeY[0],this.labelSizeX.rot),a.restore(),a.save(),a.translate(-this.padding,0),this.drawYLabels(this.ticksY,this.rangeX[0]),a.restore()),a.save(),a.beginPath(),a.rect(this.labelSizeY.width,0,this.width-this.labelSizeY.width,this.height-this.labelSizeX.height),a.clip(),o.line&&(a.lineWidth=o.lineWidth,this.drawLines(t)),o.point&&(a.lineWidth=o.pointStrokeWidth,this.drawPoints(t)),this.plot(t),a.restore(),this.after()},t.prototype.measureLabelSizeX=function(t,e,i){for(var r=this.ctx,n=0,a=0;t.length>a;a++){var o=r.measureText(t[a]);o.width>n&&(n=o.width)}var h={width:n,height:e,rot:0};if(!i)return h;var s=i/t.length;if(h.width>s){h.rot=Math.PI/4;var l=Math.cos(h.rot);h.width=n*l,h.height=h.width+e*l,h.width>s&&(h.rot=Math.PI/2,h.width=e,h.height=n)}return h},t.prototype.measureLabelSizeY=function(t,e){for(var i=this.ctx,r=1,n=0;t.length>n;n++){var a=i.measureText(t[n]);a.width>r&&(r=a.width)}return{width:r,height:e}},t.prototype.drawXGrids=function(t,e){for(var i=this.ctx,r=0;t.length>r;r++)i.beginPath(),i.xy.moveTo(t[r],e[0]),i.xy.lineTo(t[r],e[1]),i.stroke()},t.prototype.drawYGrids=function(t,e){for(var i=this.ctx,r=0;t.length>r;r++)i.beginPath(),i.xy.moveTo(e[0],t[r]),i.xy.lineTo(e[1],t[r]),i.stroke()},t.prototype.drawXScale=function(t,e,i){var r=this.ctx;r.beginPath(),r.xy.moveTo(t[0],i),r.xy.lineTo(t[1],i),r.stroke()},t.prototype.drawYScale=function(t,e,i){var r=this.ctx;r.beginPath(),r.xy.moveTo(i,t[0]),r.xy.lineTo(i,t[1]),r.stroke()},t.prototype.drawXLabels=function(t,e,i){var r=this.ctx;if(0===i){r.textBaseline="top",r.textAlign="center";for(var n=0;t.length>n;n++)r.xy.fillText(t[n],t[n],e)}else{r.textBaseline="middle",r.textAlign="right",i===Math.PI/4&&r.translate(0,.3*this.options.labelFontSize);for(var n=0;t.length>n;n++)r.save(),r.xy.translate(t[n],e),r.rotate(-i),r.fillText(t[n],0,0),r.restore()}},t.prototype.drawYLabels=function(t,e){var i=this.ctx;i.textBaseline="middle",i.textAlign="right";for(var r=0;t.length>r;r++)i.xy.fillText(t[r],e,t[r])},t.prototype.drawLines=function(t){for(var e=this.ctx,i=this.options.smooth,r=this.rangeX[1]-this.rangeX[0],n=this.rangeY[1]-this.rangeY[0],a=0;t.length>a;a++){e.strokeStyle=t[a].lineColor;var o=t[a].data;if(e.beginPath(),e.xy.moveTo(o[0][0],o[0][1]),i){for(var h=null,l=[],c=0;o.length>c;c++){var u={x:o[c][0]/r,y:o[c][1]/n,prev:h};h=u,l[c]=h,h.prev&&h.prev.prev&&s(h,i)}for(var c=1;l.length>c;c++){var h=l[c];h.cp1x&&h.cp2x?e.nxy.bezierCurveTo(h.cp1x,h.cp1y,h.cp2x,h.cp2y,h.x,h.y):h.cp1x?e.nxy.quadraticCurveTo(h.cp1x,h.cp1y,h.x,h.y):e.nxy.quadraticCurveTo(h.cp2x,h.cp2y,h.x,h.y)}}else for(var c=1;o.length>c;c++)e.xy.lineTo(o[c][0],o[c][1]);e.stroke()}},t.prototype.drawPoints=function(t){for(var e=this.ctx,i=this.options.pointCircleRadius,r=0;t.length>r;r++){e.fillStyle=t[r].pointColor,e.strokeStyle=t[r].pointStrokeColor;for(var n=t[r].data,a=0;n.length>a;a++)e.beginPath(),e.xy.arc(n[a][0],n[a][1],i,0,2*Math.PI),e.fill(),e.stroke()}},t.prototype.plot=function(){},t.prototype.before=function(){},t.prototype.after=function(){};var c=/0*$|\.\d*|e[+-]\d+/,u=[10,5,2];t.defaults={rangeX:["auto","auto"],rangeY:["auto","auto"],tickStepX:"auto",tickStepY:"auto",scale:!0,scaleColor:"rgba(0,0,0,.1)",scaleWidth:1,grid:!0,gridColor:"rgba(0,0,0,.05)",gridWidth:1,label:!0,labelFontName:"Arial",labelFontSize:20,labelFontStyle:"normal",labelColor:"#666",point:!0,pointCircleRadius:8,pointStrokeWidth:4,line:!0,lineWidth:4,smooth:.3,scalingRadius:"x"},this.Xy=t}).call(this),function(){"use strict";function t(t,i,r){if(this.native=t,r){var n=Array.prototype.slice;for(var a in t){var o=t[a];"function"==typeof o&&function(e,i){e[a]=function(){var e=n.call(arguments);return i.apply(t,e)}}(this,o)}}var h=i.x||e,s=i.y||e,l=i.width||e,c=i.height||e,u=i.radius||e;this.arc=function(e,i,r,n,a,o){t.arc(h(e),s(i),u(r),n,a,o)},this.arcTo=function(e,i,r,n,a){t.arcTo(h(e),s(i),h(r),s(n),u(a))},this.bezierCurveTo=function(e,i,r,n,a,o){t.bezierCurveTo(h(e),s(i),h(r),s(n),h(a),s(o))},this.clearRect=function(e,i,r,n){t.clearRect(h(e),s(i),l(r),c(n))},this.createImageData=function(e,i){return t.createImageData(l(e),c(i))},this.createLinearGradient=function(e,i,r,n){return t.createLinearGradient(h(e),s(i),h(r),s(n))},this.createRadialGradient=function(e,i,r,n,a,o){return t.createRadialGradient(h(e),s(i),u(r),h(n),s(a),u(o))},this.drawImage=function(e,i,r,n,a,o,u,p,d){3===arguments.length?t.drawImage(e,h(i),s(r)):5===arguments.length?t.drawImage(e,h(i),s(r),l(n),c(a)):t.drawImage(e,i,r,n,a,h(o),s(u),l(p),c(d))},this.fillRect=function(e,i,r,n){t.fillRect(h(e),s(i),l(r),c(n))},this.fillText=function(e,i,r,n){4===arguments.length?t.fillText(e,h(i),s(r),n):t.fillText(e,h(i),s(r))},this.getImageData=function(e,i,r,n){return t.getImageData(h(e),s(i),l(r),c(n))},this.isPointInPath=function(e,i){return t.isPointInPath(h(e),s(i))},this.lineTo=function(e,i){t.lineTo(h(e),s(i))},this.moveTo=function(e,i){t.moveTo(h(e),s(i))},this.putImageData=function(e,i,r,n,a,o,l){t.putImageData(e,h(i),s(r),n,a,o,l)},this.quadraticCurveTo=function(e,i,r,n){t.quadraticCurveTo(h(e),s(i),h(r),s(n))},this.rect=function(e,i,r,n){t.rect(h(e),s(i),l(r),c(n))},this.strokeRect=function(e,i,r,n){t.strokeRect(h(e),s(i),l(r),c(n))},this.strokeText=function(e,i,r,n){4===arguments.length?t.strokeText(e,h(i),s(r),n):t.strokeText(e,h(i),s(r))},this.translate=function(e,i){t.translate(h(e),s(i))}}var e=function(t){return t};this.Transform=t}.call(this);