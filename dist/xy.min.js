// Xy.js - https://github.com/thunder9/xy.js
(function(){"use strict";function t(e,i){this.ctx=e,this.options=Object.create(t.defaults);for(var r in i)this.options[r]=i[r];this.width=e.canvas.width,this.height=e.canvas.height,window.devicePixelRatio&&(e.canvas.style.width=this.width+"px",e.canvas.style.height=this.height+"px",e.canvas.width=this.width*window.devicePixelRatio,e.canvas.height=this.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio))}function e(t,e){var i=a({lower:t.options.xRange[0],upper:t.options.xRange[1],incr:t.options.xTics},e,0,function(e){var i=t.measureXLabelSize(e,t.options.labelFontSize);return{offset:i.height,hop:i.width}},t.width);return r(i.lower,i.upper,i.incr)}function i(t,e){var i=a({lower:t.options.yRange[0],upper:t.options.yRange[1],incr:t.options.yTics},e,1,function(e){var i=t.measureYLabelSize(e,t.options.labelFontSize);return{offset:i.width,hop:i.height}},t.height);return r(i.lower,i.upper,i.incr)}function r(t,e,i){var r,a=s.exec(i)[0],n=Math.pow(10,/\./.test(a)?a.length-1:-a.length),o=[],h=0;for(t=i*Math.ceil(t/i);e>=(r=t+h*i);)o[h++]=Math.round(r*n)/n;return o}function a(t,e,i,a,o){var h,s;if("auto"===t.lower||"auto"===t.upper){h=Number.MAX_VALUE,s=Number.MIN_VALUE;for(var l=0;e.length>l;l++)for(var c=e[l].data,u=0;c.length>u;u++)c[u][i]>s&&(s=c[u][i]),h>c[u][i]&&(h=c[u][i])}if("auto"!==t.lower&&(h=t.lower),"auto"!==t.upper&&(s=t.upper),"auto"===t.incr)for(var p=2;o>p;p++){var v=n(s-h,p),f=a(r(h,s,v));if(p>o/(1.5*f.hop))break;t.incr=v}return"auto"===t.lower&&(t.lower=t.incr*Math.floor(h/t.incr)),"auto"===t.upper&&(t.upper=t.incr*Math.ceil(s/t.incr)),t}function n(t,e){for(var i=Math.floor(Math.log(t)*Math.LOG10E),r=0;t>0&&e>0;i--)for(var a=0;l.length>a;a++){var n=Math.pow(10,i)*l[a];if(t/n>e)return r;r=n}return r}function o(t,e){var i,r=t.x-t.prev.prev.x,a=t.y-t.prev.prev.y,n=r*r+a*a,o=h(t,t.prev),s=h(t.prev,t.prev.prev);i=s>0?Math.sqrt(s/n)*e:Math.sqrt(o/n)*e,t.prev.cp2x=t.prev.x-r*i,t.prev.cp2y=t.prev.y-a*i,i=Math.sqrt(o/n)*e,t.cp1x=t.prev.x+r*i,t.cp1y=t.prev.y+a*i}function h(t,e){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}t.prototype.draw=function(t,r){var a=this.ctx,n=this.options;if(!this.xTics||!this.yTics||r){a.font=n.labelFontStyle+" "+n.labelFontSize+"px "+n.labelFontFamily,this.xTics=e(this,t),this.yTics=i(this,t);var o=this.xRange=[],h=this.yRange=[];o[0]="auto"===n.xRange[0]?this.xTics[0]:+n.xRange[0],o[1]="auto"===n.xRange[1]?this.xTics[this.xTics.length-1]:+n.xRange[1],h[0]="auto"===n.yRange[0]?this.yTics[0]:+n.yRange[0],h[1]="auto"===n.yRange[1]?this.yTics[this.yTics.length-1]:+n.yRange[1];var s=this.padding=Math.max(n.labelFontSize/2,n.pointCircleRadius+n.pointStrokeWidth/2),l=this.width,c=this.height,u=this.yLabelSize=this.measureYLabelSize(this.yTics,n.labelFontSize),p=u.width+s,v=this.xLabelSize=this.measureXLabelSize(this.xTics,n.labelFontSize,l-p),f=v.height+s,d=this.xLength=o[1]-o[0],g=this.yLength=h[1]-h[0],x=(l-p-s)/d,y=(c-f-s)/g;a.xy=new Transform(a,{x:function(t){return(t-o[0])*x+p},y:function(t){return(h[0]-t)*y+c-f}}),a.nxy=new Transform(a,{x:function(t){return(t*d-o[0])*x+p},y:function(t){return(h[0]-t*g)*y+c-f}})}a.clearRect(0,0,this.width,this.height),this.before(),n.grid&&(a.strokeStyle=n.gridColor,a.lineWidth=n.gridWidth,this.drawXGrids(this.xTics,this.yRange),this.drawYGrids(this.yTics,this.xRange)),n.scale&&(a.strokeStyle=n.scaleColor,a.lineWidth=n.scaleWidth,this.drawXScale(this.xRange,this.xTics,this.yTics[0]),this.drawYScale(this.yRange,this.yTics,this.xTics[0])),n.label&&(a.fillStyle=n.labelColor,a.save(),a.translate(0,this.padding),this.drawXLabels(this.xTics,this.yRange[0],this.xLabelSize.rot),a.restore(),a.save(),a.translate(-this.padding,0),this.drawYLabels(this.yTics,this.xRange[0]),a.restore()),a.save(),a.rect(this.yLabelSize.width,0,this.width-this.yLabelSize.width,this.height-this.xLabelSize.height),a.clip(),n.line&&(a.lineWidth=n.lineWidth,this.drawLines(t)),n.point&&(a.lineWidth=n.pointStrokeWidth,this.drawPoints(t)),this.plot(t),a.restore(),this.after()},t.prototype.measureXLabelSize=function(t,e,i){for(var r=this.ctx,a=0,n=0;t.length>n;n++){var o=r.measureText(t[n]);o.width>a&&(a=o.width)}var h={width:a,height:e,rot:0};if(!i)return h;var s=i/t.length;if(h.width>s){h.rot=Math.PI/4;var l=Math.cos(h.rot);h.width=a*l,h.height=h.width+e*l,h.width>s&&(h.rot=Math.PI/2,h.width=e,h.height=a)}return h},t.prototype.measureYLabelSize=function(t,e){for(var i=this.ctx,r=1,a=0;t.length>a;a++){var n=i.measureText(t[a]);n.width>r&&(r=n.width)}return{width:r,height:e}},t.prototype.drawXGrids=function(t,e){for(var i=this.ctx,r=1;t.length>r;r++)i.beginPath(),i.xy.moveTo(t[r],e[0]),i.xy.lineTo(t[r],e[1]),i.stroke()},t.prototype.drawYGrids=function(t,e){for(var i=this.ctx,r=1;t.length>r;r++)i.beginPath(),i.xy.moveTo(e[0],t[r]),i.xy.lineTo(e[1],t[r]),i.stroke()},t.prototype.drawXScale=function(t,e,i){var r=this.ctx;r.beginPath(),r.xy.moveTo(t[0],i),r.xy.lineTo(t[1],i),r.stroke()},t.prototype.drawYScale=function(t,e,i){var r=this.ctx;r.beginPath(),r.xy.moveTo(i,t[0]),r.xy.lineTo(i,t[1]),r.stroke()},t.prototype.drawXLabels=function(t,e,i){var r=this.ctx;if(0===i){r.textBaseline="top",r.textAlign="center";for(var a=0;t.length>a;a++)r.xy.fillText(t[a],t[a],e)}else{r.textBaseline="middle",r.textAlign="right",i===Math.PI/4&&r.translate(0,.3*this.options.labelFontSize);for(var a=0;t.length>a;a++)r.save(),r.xy.translate(t[a],e),r.rotate(-i),r.fillText(t[a],0,0),r.restore()}},t.prototype.drawYLabels=function(t,e){var i=this.ctx;i.textBaseline="middle",i.textAlign="right";for(var r=0;t.length>r;r++)i.xy.fillText(t[r],e,t[r])},t.prototype.drawLines=function(t){for(var e=this.ctx,i=this.options.smooth,r=this.xLength,a=this.yLength,n=0;t.length>n;n++){e.strokeStyle=t[n].lineColor;var h=t[n].data;if(e.beginPath(),e.xy.moveTo(h[0][0],h[0][1]),i){for(var s=null,l=[],c=0;h.length>c;c++){var u={x:h[c][0]/r,y:h[c][1]/a,prev:s};s=u,l[c]=s,s.prev&&s.prev.prev&&o(s,i)}for(var c=1;l.length>c;c++){var s=l[c];s.cp1x&&s.cp2x?e.nxy.bezierCurveTo(s.cp1x,s.cp1y,s.cp2x,s.cp2y,s.x,s.y):s.cp1x?e.nxy.quadraticCurveTo(s.cp1x,s.cp1y,s.x,s.y):e.nxy.quadraticCurveTo(s.cp2x,s.cp2y,s.x,s.y)}}else for(var c=1;h.length>c;c++)e.xy.lineTo(h[c][0],h[c][1]);e.stroke()}},t.prototype.drawPoints=function(t){for(var e=this.ctx,i=this.options.pointCircleRadius,r=0;t.length>r;r++){e.fillStyle=t[r].pointColor,e.strokeStyle=t[r].pointStrokeColor;for(var a=t[r].data,n=0;a.length>n;n++)e.beginPath(),e.xy.arc(a[n][0],a[n][1],i,0,2*Math.PI),e.fill(),e.stroke()}},t.prototype.plot=function(){},t.prototype.before=function(){},t.prototype.after=function(){};var s=/0*$|\.\d*/,l=[5,2,1];t.defaults={xRange:["auto","auto"],yRange:["auto","auto"],xTics:"auto",yTics:"auto",scale:!0,scaleColor:"rgba(0,0,0,.1)",scaleWidth:1,grid:!0,gridColor:"rgba(0,0,0,.05)",gridWidth:1,label:!0,labelFontFamily:"'Arial'",labelFontSize:20,labelFontStyle:"normal",labelColor:"#666",point:!0,pointCircleRadius:8,pointStrokeWidth:4,line:!0,lineWidth:4,smooth:.3},this.Xy=t}).call(this),function(){"use strict";function t(t,i,r){if(this.native=t,r){var a=Array.prototype.slice;for(var n in t){var o=t[n];"function"==typeof o&&function(e,i){e[n]=function(){var e=a.call(arguments);return i.apply(t,e)}}(this,o)}}var h=i.x||e,s=i.y||e,l=i.width||e,c=i.height||e,u=i.radius||e,p=i.matrix||function(t,e,i,r,a){return[h(t),s(e),l(i),c(r),u(a)]};this.arc=function(e,i,r,a,n,o){var h=p(e,i,null,null,r);t.arc(h[0],h[1],h[4],a,n,o)},this.arcTo=function(e,i,r,a,n){var o=p(e,i,null,null,n),h=p(r,a,null,null,n);t.arcTo(o[0],o[1],h[0],h[1],o[4])},this.bezierCurveTo=function(e,i,r,a,n,o){var h=p(e,i),s=p(r,a),l=p(n,o);t.bezierCurveTo(h[0],h[1],s[0],s[1],l[0],l[1])},this.clearRect=function(e,i,r,a){var n=p(e,i,r,a);t.clearRect(n[0],n[1],n[2],n[3])},this.createImageData=function(e,i){var r=p(null,null,e,i);return t.createImageData(r[2],r[3])},this.createLinearGradient=function(e,i,r,a){var n=p(e,i),o=p(r,a);return t.createLinearGradient(n[0],n[1],o[0],o[1])},this.createRadialGradient=function(e,i,r,a,n,o){var h=p(e,i,null,null,r),s=p(a,n,null,null,o);return t.createRadialGradient(h[0],h[1],h[4],s[0],s[1],s[4])},this.drawImage=function(e,i,r,a,n,o,h,s,l){if(9===arguments.length){var c=p(o,h,s,l);t.drawImage(e,i,r,a,n,c[0],c[1],c[2],c[3])}else{var c=p(i,r,a,n);5===arguments.length?t.drawImage(e,c[0],c[1],c[2],c[3]):t.drawImage(e,c[0],c[1])}},this.fillRect=function(e,i,r,a){var n=p(e,i,r,a);t.fillRect(n[0],n[1],n[2],n[3])},this.fillText=function(e,i,r,a){var n=p(i,r);4===arguments.length?t.fillText(e,n[0],n[1],a):t.fillText(e,n[0],n[1])},this.getImageData=function(e,i,r,a){var n=p(e,i,r,a);return t.getImageData(n[0],n[1],n[2],n[3])},this.isPointInPath=function(e,i){var r=p(e,i);return t.isPointInPath(r[0],r[1])},this.lineTo=function(e,i){var r=p(e,i);t.lineTo(r[0],r[1])},this.moveTo=function(e,i){var r=p(e,i);t.moveTo(r[0],r[1])},this.putImageData=function(e,i,r,a,n,o,h){var s=p(i,r);t.putImageData(e,s[0],s[1],a,n,o,h)},this.quadraticCurveTo=function(e,i,r,a){var n=p(e,i),o=p(r,a);t.quadraticCurveTo(n[0],n[1],o[0],o[1])},this.rect=function(e,i,r,a){var n=p(e,i,r,a);t.rect(n[0],n[1],n[2],n[3])},this.strokeRect=function(e,i,r,a){var n=p(e,i,r,a);t.strokeRect(n[0],n[1],n[2],n[3])},this.strokeText=function(e,i,r,a){var n=p(i,r);4===arguments.length?t.strokeText(e,n[0],n[1],a):t.strokeText(e,n[0],n[1])},this.translate=function(e,i){var r=p(e,i);t.translate(r[0],r[1])}}var e=function(t){return t};this.Transform=t}.call(this);